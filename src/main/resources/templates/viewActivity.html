<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" context="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preload" as="image" th:href="@{/image/landscape.jpeg}">
    <link th:href="@{/css/styles.css}" rel="stylesheet">
    <link th:href="@{/css/profile.css}" rel="stylesheet">
    <link th:href="@{/css/view-activity.css}" rel="stylesheet">
    <link th:href="@{/css/team-profile.css}" rel="stylesheet">
    <link th:href="@{/css/formation.css}" rel="stylesheet">
    <link th:href="@{/css/view-all.css}" rel="stylesheet">
    <link th:href="@{/css/create-activity.css}" rel="stylesheet"/>

    <title>View Activity</title>
</head>
<body class="profile-background">
<div th:insert="~{fragments/navBar.html::navbar(displayTeams=${displayTeams})}"></div>




<div class="team-profile-form">

    <span id="stayOnTab_Name" style="display: none;" th:text="${stayOnTab_name}"></span>
    <span id="stayOnTab_index" style="display: none;" th:text="${stayOnTab_index}"></span>

    <div class="wrapper-profile" id="wrapper-profile">
        <div class="tab-box">
            <div class="tab active" id="generalTab">
                <img class="tab-icon" th:src="@{/image/icons/activity.png}"/>
                <button class="tab-button"> General &nbsp;</button>
            </div>
            <div class="tab" id="factsTab" >
                <img class ="tab-icon" th:src="@{/image/icons/editform.svg}"/>
                <button class="tab-button" > Facts &nbsp;</button>
                <div class="tab-line"></div>
            </div>
            <div class="tab" id="formations-tab" th:if="${canShowScores}">
                <img class ="tab-icon"  th:src="@{/image/icons/formation.svg}"/>
                <button class="tab-button" >Formations &nbsp;</button>
            </div>
            <div class="tab" id="scoreTab" th:if="${canShowScores}">
                <img class ="tab-icon"  th:src="@{/image/icons/score.svg}"/>
                <button class="tab-button" > Score &nbsp;</button>
            </div>
        </div>

        <div class="content-box active" id="general-tab">
            <div class="content general">
                <div class="general-activity-header" style="font-size: x-large; text-align: center; padding: 20px">
                    <h2 th:text="|${activity.activityType.name()}: ${activityStartTitle}|"></h2>
                </div>
                <div class="general-activity-body" style="text-align: center">
                    <div style="width: 100%; display: inline-block">
                    <div class="general-activity-left" style="width: 46%; float:left; margin-right: 1%; margin-left: 3%; text-align: left">
                        <div>
                            <h3 class="attribute-type">Location</h3>
                            <h3 th:text="*{activity.location}"></h3>
                            <br>
                            <h3 class="attribute-type">Date and Time</h3>
                            <h3 th:text="${activityDateTime}"></h3>
                        </div>
                    </div>
                    <div class="general-activity-right" style="width: 46%; float:left; margin-left: 2%; margin-right:2%;text-align: left">
                        <h3 th:if="${activity.team != null}" class="attribute-type">Team</h3>
                        <h3 th:if="${activity.team != null}" th:text="${activity.team.name}"></h3>
                        <br th:if="${activity.team != null}">
                        <h3 class="attribute-type">Description</h3>
                        <h3 th:text="${activity.description}"></h3>
                    </div>
                        <div style="width: 100%; display: inline-block">
                        <div class="submit-button" style="width: 25%; min-width: 150px; float: left; padding-top: 25px; padding-bottom: 8px">
                            <a th:if="${activity.team==null || (activity.team.isManager(currentUser.get()) || activity.team.isCoach(currentUser.get()))}"
                               th:href="@{create-activity(edit=${activity.id})}" type="button">
                                <button type="submit" id="editActivityBtn">Edit</button>
                            </a>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content-box" id="facts-tab" style="margin-bottom: 16px">
            <div class="content" style="height: 400px; overflow: auto;">
                <div class="submit-button" style="padding-top: 10px; padding-bottom: 10px">
                    <button style="width: 50%">Add Fact</button>
                </div>
                <table style="padding: 15px; border-collapse: collapse; border: 2px solid; margin:2%; width:96%">
                    <thead style="background-color: #0b2239">
                    <tr>
                        <th style="width: 30%; background-color: #0b2239"> Time </th>
                        <th style="width: 70%; background-color: #0b2239"> Description </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${factList.isEmpty()}">
                        <td colspan="2"> No Recorded Facts </td>
                    </tr>
                    <tr th:each="fact : ${factList}">
                        <td><span th:text="${fact.timeOfEvent} ?: 'No Time Recorded'">No Time Listed</span></td>
                        <td><span th:text="${fact.description}">Description</span></td>
                    </tr>
                    </tbody>
                </table>

            </div>
        </div>

        <div class="content-box" style="margin-bottom: 500px">
            <div class="content">


            </div>
        </div>


        <div class="content-box" id="scores-tab">
            <div class="content">

                <div>
                <div class="score-display">
                    <div class="team-names-display">

                        <h3 style="font-size: 30px" th:text="${activity.team}"></h3>
                        <h3 style="font-weight: 100; font-size: 27px"> vs </h3>
                        <h3 style="font-size: 30px">Opponent</h3>
                    </div>

                    <div class="team-scores" th:if="${activity.activityTeamScore != null && activity.otherTeamScore != null}">

                        <h1 class="teamScore" th:text="${activity.activityTeamScore}"></h1>
                        <h1 style="font-weight: 100"> - </h1>
                        <h1 class="otherTeamScore" th:text="${activity.otherTeamScore}"></h1>
                    </div>
                    <h3 class="winner-text" id="winnerText" th:text="${outcomeString}" ></h3>
                </div>



                <div class="goalFacts">
                    <div class="goal-table-headers">
                        <h4 class="player-header"> Scoring </h4>
                    </div>
                    <ul>
                        <li th:each="goal : ${activityGoals}">
                            <button class="collapsible" >
                                <img th:src="@{/user-profile-picture/{id}(id = ${goal.scorer.userId})}"  class="scorer-player-image"  alt="Player Image">
                                <h3 th:text="${goal.scorer.firstName + ' ' + goal.scorer.lastName}"> </h3>
                                <h4 class="goal-text" th:text="${goal.goalValue == 1 ? goal.goalValue + ' pt' : goal.goalValue + ' pts'}"></h4>

                                <div class="timeDiv">
                                    <h4 style="margin-top: 1px;" th:text="${goal.timeOfEvent} + '\''"></h4>
                                </div>

                            </button>

                            <div class="goal-description">
                                <hr class="solid">
                                <p th:text="${goal.description}"></p>
                            </div>
                        </li>
                    </ul>


                </div>



                </div>


</div>


    </div>




    <script>

        var collapsible = document.getElementsByClassName("collapsible");
        var i;

        for (i = 0; i < collapsible.length; i++) {
            collapsible[i].addEventListener("click", function() {
                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.maxHeight){
                    content.style.maxHeight = null;
                    content.style.border = "none";
                    this.style.borderRadius = "10px 10px 10px 10px";
                    this.style.borderBottom = "2px solid #778da9"



                } else {
                    content.style.maxHeight = content.scrollHeight + 5 + "px";

                    content.style.border = "2px #778da9"
                    content.style.borderStyle = "none solid solid solid"
                    this.style.borderRadius = "10px 10px 0 0";
                    this.style.borderBottom = "none";


                }
            });
        }


        const tabs = document.querySelectorAll('.tab');
        const tabLine = document.querySelector('.tab-line');
        const displayBox = document.querySelectorAll('.content-box');
        const displayContent = document.querySelectorAll('.content');


        //functionality staying on tab after form submission
        var stayOnTab_Name =  document.getElementById("stayOnTab_Name").innerHTML;
        var stayOnTab_Index =  document.getElementById("stayOnTab_index").innerHTML;

        console.log("tabname" + stayOnTab_Name);
        console.log("tabindex" + stayOnTab_Index);

        if (stayOnTab_Name === "scoreTab" || stayOnTab_Name === "generalTab" || stayOnTab_Name === "formations-tab" || stayOnTab_Name === "factsTab") {
            var tabToBeActive = document.getElementById(stayOnTab_Name)

            console.log(tabToBeActive)
            console.log(stayOnTab_Name)
            tabs.forEach(otherTab => {
                otherTab.classList.remove('active');
            });
            tabToBeActive.classList.add('active')

            displayBox.forEach(box => {
                box.classList.remove('active')
            });
            displayBox[stayOnTab_Index].classList.add('active');
            displayContent.forEach(content => {
                content.classList.remove('active')
            });
            displayContent[stayOnTab_Index].classList.add('active');

        }




        //functionality for clicking on tabs
        tabs.forEach((tab, index) => {
            tab.addEventListener('click', (e) => {
                tabs.forEach(otherTab => {
                    otherTab.classList.remove('active');
                });
                tab.classList.add('active');
                if (index === 0) {
                    tabLine.style.left = "18px";
                } else if (index === 1) {
                    tabLine.style.left = "247px";
                } else if (index === 2) {
                    tabLine.style.left = "460px";
                }
                else {
                    tabLine.style.left = "685px";
                }
                displayBox.forEach(box => {
                    box.classList.remove('active')
                });
                displayBox[index].classList.add('active');
                displayContent.forEach(content => {
                    content.classList.remove('active')
                });
                displayContent[index].classList.add('active');
            });
        });
    </script>











<!--<div class="act-container">
    <div class="act-info">
        <div class="act-details">
            <h3 th:if="${activity.team != null}" th:text="${activity.team} + 's'"></h3>

            <h3> Activity Information </h3>
            <h4 th:text="|Type:&nbsp&nbsp ${activity.activityType}|"></h4>
            <h4 th:text="|Location:&nbsp&nbsp ${activity.location}|"></h4>
            <h4 th:text="|Description:&nbsp&nbsp ${activity.description}|"></h4>

            <div class="edit-act-button">
                <a th:if="${(activity.team!=null && (activity.team.isManager(activity.activityOwner) ||
                activity.team.isCoach(activity.activityOwner))) || activity.team==null}" class="edit-button"
                   th:href="@{createActivity(edit=${activity.id})}">
                    <button type="button"><img th:src="@{image/icons/pencil.svg}"> <span>Edit Activity</span></button>
                </a>
            </div>

        </div>
        <div class="nested-grid">
            <div class="act-date-time">
                <div class="start-date-time">
                    <h4> Start </h4>
                    <span class="date"
                          th:with="startDate=${#temporals.format(activity.activityStart, 'dd MMM yyyy')}"
                          th:text="${startDate}">

                    </span>
                    <span class="time" th:with="startTime=${#temporals.format(activity.activityStart, 'hh:mma')}"
                          th:text="${startTime}">

                    </span>

                </div>
                <div class="end-date-time">
                    <h4> End </h4>
                    <span class="date" th:with="endDate=${#temporals.format(activity.activityEnd, 'dd MMM yyyy')}"
                          th:text="${endDate}">
                    </span>
                    <span class="time" th:with="endTime=${#temporals.format(activity.activityEnd, 'hh:mma')}"
                          th:text="${endTime}">

                    </span>

                </div>
            </div>
            <div class="act-score" th:if="${canShowScores}">
                <div class ="team-names">
                    <span>Team A</span>
                    <span> vs </span>
                    <span> Team B </span>
                </div>
                <div class="score">
                    <span th:text="${activity.activityTeamScore != null && activity.otherTeamScore != null ? activity.activityTeamScore + ' : ' + activity.otherTeamScore : 'NA'}"></span>
                </div>
                <span id="winnerText" style="margin-right: 5%" th:text="${outcomeString}" ></span>
            </div>

            <div class="submit-button">
                <button th:unless="${noFacts}" onclick="modal.style.display = 'block'" type="button">Add Activity Statistics</button>
            </div>
        </div>
                
        <div id="addEventModal" class="modal" th:style="${scoreInvalid != null ? 'display:block' : 'display:none'}">

            <div class="modal-content event">
                <span class="close" onclick="modal.style.display = 'none'">&times;</span>
                <form th:action="@{view-activity}" id="createEventForm" method="post" th:object="${createEventForm}" class="view-activity-form">
                    <input type="hidden" th:name="actId" th:value="${activity.getId()}"/>
                    <h3>Add Overall Score</h3>

                    <div class="overall-scores-box">

                        <div style="float: left">
                        <label style="display:block;" for="overall-score-team">Team:</label>
                            <input class="overall-score-input" name="overallScoreTeam" id="overall-score-team" type="text-area" th:field="*{overallScoreTeam}" th:value="${overallScoreTeamSaved}" data-cy="overallScoreTeam">

                        </div>

                        <div class="opponentScoreDiv">
                            <label style="display:block; margin-left: 46%;" for="overall-score-opponent">Opponent:</label>
                            <input style="float: right; margin-right: 10px;" class="overall-score-input" name="overallScoreOpponent" id="overall-score-opponent" type="text-area" th:field="*{overallScoreOpponent}" th:value="${overallScoreOpponentSaved}" data-cy="overallScoreOpponent">

                        </div>
                    </div>
                    <div th:each="err : ${#fields.errors('overallScoreTeam')}" th:text="${err}" class="error-message"></div>


                    <label class="helpText"> Scores for both teams should be of same type i.e either 12-4 and 9-3 or 23 and 18 </label>


                    <div class="select-container">
                    <label for="activityOutcomes" style="display: block">Outcome of Game for Home Team <span class="required">*</span> </label>
                    <div class="select-box">
                        <select id="activityOutcomes" name="activityOutcomes">
                            <option th:value="${noOutcome}">Outcome of Activity</option>
                            <option th:each="outcome : ${activityOutcomes}"
                                    th:value="${outcome}"
                                    th:text="${outcome}"
                                    th:selected="${outcome == selectedOutcome}"></option>
                        </select>
                    </div>
                    </div>

                    <hr class="rounded">
                    <h3 style="margin-bottom: 3%;">Add a new event</h3>

                    <div th:if="${!noFacts}" class="select-container">
                        <label for="factType" style="display: block">Event Type: <span class="required">*</span> </label>
                        <div class="select-box">
                            <select id="factType" name="factType">
                                <option th:value="${noFact}">Select Fact Type</option>

                                <option th:each="fact : ${possibleFactTypes}"
                                        th:value="${fact}"
                                        th:text="${fact}"></option>
                            </select>
                        </div>
                    </div>

                    <div class="select-container" id="factDescBox">
                        <div class="description-box">
                        <label for="description">Description: <span class="required">*</span></label>
                        <textarea class="description-text" id="description" th:name="description" autofocus placeholder=""
                          th:text="${description}"></textarea>
                        </div>
                        <div th:each="err : ${#fields.errors('description')}" th:text="${err}" class="error-message"></div>

                        <label for="time"></label>
                        <input type="text-area" name="time" value="time">
                        <div id="additionalFields"></div>
                        <div th:each="err : ${#fields.errors('subOn')}" th:text="${err}" class="error-message"></div>

                    </div>
                    <div class="submit-button">
                        <button id="createEvent" type="submit" class="registerLoginButton">Add activity statistics</button>
                    </div>
                    
                </form>

            </div>

        </div>
        <div th:unless="${noFacts}" class="act-facts">
            <h4> Facts </h4>
            <div class="facts-table">
                <ul>
                    <li th:each="fact : ${activityFacts}">
                        <span class="description" th:text="${fact.description}"></span>
                        <span class="time" th:text="${fact.timeOfEvent}"></span>
                    </li>
                </ul>
            </div>

        </div>
    </div>

    <div class="act-game-friendly" th:if="${canShowPlayers}">
        <div class="act-lineup">
            <h3> Line Up </h3>
            <div th:insert="~{fragments/formationDisplay.html}"></div>
            <input type="hidden" onload=renderPlayers("4-1-2-2") />
        </div>
        <div class="act-subs" th:if="${canShowPlayers}">
            <h4> Substitutions </h4>
            <div class="subs-table">
                <ul>
                    <li th:each="fact : ${activitySubstitutions}">
                        <span class="sub-pic">
                            <img th:src="@{/user-profile-picture/{id}(id = ${fact.playerOn.userId})}"  alt="User image">
                        </span>
                        <span class="description"
                              th:text="${fact.playerOn.firstName} + '         ' + ${fact.playerOn.lastName}"></span>
                        <span class="description" th:text="${fact.timeOfEvent}"></span>
                    </li>
                </ul>
            </div>
        </div>


    </div>
</div>
<script type="text/javascript" th:inline="javascript">
    window.onload = function() {
        renderPlayers("4-1-2-2");
    };
</script>
</div>-->
</div>
</div>
</body>
<footer>
    <p>
        Image by <a
            href="https://www.freepik.com/free-vector/flat-happy-children-play-run-cycling-public-park_27059506.htm#query=nature%20sports%20illustration&position=0&from_view=search&track=ais">redgreystock</a>
        on Freepik
    </p>
</footer>

</html>

<script>
    var modal = document.getElementById("addEventModal");

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>
<script th:inline="javascript">
    // Get a reference to the dropdown select element
    var factTypeSelect = document.getElementById("factType");

    // Get a reference to the div that will contain the additional fields
    var additionalFieldsDiv = document.getElementById("additionalFields");



    // Function to handle the change event of the dropdown
    function handleDropdownChange() {
        // Clear the additional fields div
        additionalFieldsDiv.innerHTML = "";
        var factDescBox = document.getElementById("factDescBox");

        // Get the selected option value
        var selectedOption = factTypeSelect.value;

        //setup required span
        var requiredSpan = document.createElement("span");
        requiredSpan.innerText = "*";
        requiredSpan.classList.add("required");

        var oppositionGoalValueLabelHelpText = document.createElement("label");
        oppositionGoalValueLabelHelpText.classList.add("helpText");
        oppositionGoalValueLabelHelpText.innerHTML = "Default is 1 if not entered"

        var goalValueInput = document.createElement("input");
        var goalValueLabel = document.createElement("label");
        goalValueLabel.innerHTML = "Goal value:";
        goalValueLabel.style.display = "block";
        goalValueLabel.appendChild(requiredSpan);
        goalValueInput.name = "goalValue"
        goalValueInput.classList.add("overall-score-input")
        goalValueInput.type = "number"
        goalValueInput.defaultValue = "1"
        goalValueInput.min = "1"


        if (selectedOption === "NONE") {
            factDescBox.style.display = "none";
        }

        // Check if the selected option has additional fields
        if (selectedOption === "GOAL") {
            factDescBox.style.display = "block";
            // Create a new select element for the scorer
            var selectScorer = document.createElement("select");
            selectScorer.name = "scorer";

            var scorerLabel = document.createElement("label");
            scorerLabel.innerHTML = "Scorer:";
            scorerLabel.style.display = "block";
            scorerLabel.appendChild(requiredSpan);

            /*[# th:each="player : ${activity.getInvolvedMembers()}"]*/
            // Create an option element for each team member
            var option = document.createElement("option");
            option.value = /*[[${player.getUserId()}]]*/ '';
            option.text = /*[[${player.firstName}]]*/ '';
            selectScorer.appendChild(option);
            /*[/]*/

            // Append the select element to the additional fields div
            additionalFieldsDiv.appendChild(scorerLabel);
            additionalFieldsDiv.appendChild(selectScorer);
            additionalFieldsDiv.appendChild(goalValueLabel);
            additionalFieldsDiv.appendChild(goalValueInput);
            additionalFieldsDiv.appendChild(oppositionGoalValueLabelHelpText);

        }

        if (selectedOption === 'SUBSTITUTION') {
            factDescBox.style.display = "block";

            // new select element for the player subbed off 
            var selectPlayerOff = document.createElement("select");
            selectPlayerOff.name = "playerOff";

            var playerOffLabel = document.createElement("label");
            playerOffLabel.innerHTML = "Player Off:";
            playerOffLabel.style.display = "block";
            playerOffLabel.appendChild(requiredSpan);

            
            /*[# th:each="player : ${activity.getInvoledMembersNoManager()}"]*/
            // Create an option element for each team member
            var option = document.createElement("option");
            option.value = /*[[${player.getUserId()}]]*/ '';
            option.text = /*[[${player.firstName}]]*/ '';
            selectPlayerOff.appendChild(option);
            /*[/]*/

            // Append the select element to the additional fields div
            additionalFieldsDiv.appendChild(playerOffLabel);
            additionalFieldsDiv.appendChild(selectPlayerOff);
            
            // new select element for the player subbed on 
            var selectPlayerOn = document.createElement("select");
            selectPlayerOn.name = "playerOn";

            var playerOnLabel = document.createElement("label");
            playerOnLabel.innerHTML = "Player On:";
            playerOnLabel.style.display = "block";
            playerOnLabel.appendChild(requiredSpan);

            /*[# th:each="player : ${activity.getInvoledMembersNoManager()}"]*/
            // Create an option element for each team member
            var option = document.createElement("option");
            option.value = /*[[${player.getUserId()}]]*/ '';
            option.text = /*[[${player.firstName}]]*/ '';
            selectPlayerOn.appendChild(option);
            /*[/]*/

            // Append the select element to the additional fields div
            additionalFieldsDiv.appendChild(playerOnLabel);
            additionalFieldsDiv.appendChild(selectPlayerOn);
        }

        if (selectedOption === "OPPOSITION_GOAL") {
            factDescBox.style.display = "block";

            var oppositionGoalValueLabel = document.createElement("label");
            oppositionGoalValueLabel.innerHTML = "Goal value:";
            oppositionGoalValueLabel.style.display = "block";
            oppositionGoalValueLabel.appendChild(requiredSpan);

            additionalFieldsDiv.appendChild(oppositionGoalValueLabel);
            additionalFieldsDiv.appendChild(goalValueInput);
            additionalFieldsDiv.appendChild(oppositionGoalValueLabelHelpText);

        }
    }

    handleDropdownChange()
    // Attach the event listener to the dropdown select element
    factTypeSelect.addEventListener("change", handleDropdownChange);
</script>
