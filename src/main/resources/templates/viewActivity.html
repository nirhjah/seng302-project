<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" context="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preload" as="image" th:href="@{/image/landscape.jpeg}">
    <link th:href="@{/css/styles.css}" rel="stylesheet">
    <link th:href="@{/css/profile.css}" rel="stylesheet">
    <link th:href="@{/css/view-activity.css}" rel="stylesheet">
    <link th:href="@{/css/team-profile.css}" rel="stylesheet">
    <link th:href="@{/css/formation.css}" rel="stylesheet">
    <link th:href="@{/css/view-all.css}" rel="stylesheet">
    <link th:href="@{/css/create-activity.css}" rel="stylesheet"/>

    <title>View Activity</title>
</head>
<body class="profile-background">
<div th:insert="~{fragments/navBar.html::navbar(displayTeams=${displayTeams})}"></div>


<div class="team-profile-form">

    <span id="stayOnTab_Name" style="display: none;" th:text="${stayOnTab_name}"></span>
    <span id="stayOnTab_index" style="display: none;" th:text="${stayOnTab_index}"></span>

    <div class="wrapper-profile" id="wrapper-profile">
        <div class="tab-box">
            <div class="tab active" id="generalTab">
                <img class="tab-icon" th:src="@{/image/icons/activity.png}"/>
                <button class="tab-button"> General &nbsp;</button>
            </div>
            <div class="tab" id="facts-tab">
                <img class="tab-icon" th:src="@{/image/icons/editform.svg}"/>
                <button class="tab-button"> Facts &nbsp;</button>
                <div class="tab-line"></div>
            </div>
            <div class="tab" id="formations-tab" th:if="${canShowScores}">
                <img class="tab-icon" th:src="@{/image/icons/formation.svg}"/>
                <button class="tab-button" onclick="render()"> Formations &nbsp;
                </button>

            </div>
            <div class="tab" id="score-tab" th:if="${canShowScores}">
                <img class="tab-icon" th:src="@{/image/icons/score.svg}"/>
                <button class="tab-button"> Score &nbsp;</button>
            </div>
        </div>

        <div class="content-box active" id="general-tab">
            <div class="content general">
                <div class="general-activity-header" style="font-size: x-large; text-align: center; padding: 20px">
                    <h2 th:text="|${activity.activityType.name()}: ${activityStartTitle}|"></h2>
                </div>
                <div class="general-activity-body" style="text-align: center">
                    <div style="width: 100%; display: inline-block">
                    <div class="general-activity-left" style="width: 46%; float:left; margin-right: 1%; margin-left: 3%; text-align: left">
                        <div>
                            <h3 class="attribute-type">Location</h3>
                            <h3 th:text="*{activity.location}"></h3>
                            <br>
                            <h3 class="attribute-type">Date and Time</h3>
                            <h3 th:text="${activityDateTime}"></h3>
                        </div>
                    </div>
                    <div class="general-activity-right" style="width: 46%; float:left; margin-left: 2%; margin-right:2%;text-align: left">
                        <h3 th:if="${activity.team != null}" class="attribute-type">Team</h3>
                        <h3 th:if="${activity.team != null}" th:text="${activity.team.name}"></h3>
                        <br th:if="${activity.team != null}">
                        <h3 class="attribute-type">Description</h3>
                        <h3 th:text="${activity.description}"></h3>
                        <br th:if="${canShowScores}">
                        <h3 th:if="${canShowScores}" class="attribute-type">Outcome</h3>
                        <h3 th:if="${canShowScores  && completed == null}">Activity Not Completed</h3>
                        <h3 th:if="${activity.outcome != null}" th:text="${activity.outcome}"></h3>
                        <h3 th:if="${activity.outcome == null && canShowScores  && completed != null
                            && !(activity.team.isManager(currentUser.get()) ||
                            activity.team.isCoach(currentUser.get()))}">Outcome Not Set</h3>
                        <div th:if="${activity.outcome == null && completed != null
                            && (activity.team.isManager(currentUser.get()) ||
                            activity.team.isCoach(currentUser.get()))}" class="submit-button">
                            <button style="width: 50%; float:left;" onclick="outcomeModal.style.display = 'block'" type="button">Add Outcome</button>
                        </div>

                        <div id="outcomeModal" class="modal">

                            <div class="modal-content event" style="bottom: unset; width: 20%">
                                <span class="close" onclick="outcomeModal.style.display = 'none'">&times;</span>
                                <form style="height: unset" th:action="@{add-outcome}" method="post">
                                    <input type="hidden" th:name="actId" th:value="${activity.getId()}"/>
                                    <h3 style="text-align: center; font-size: x-large; padding-bottom: 10px">Add Outcome</h3>
                                    <div class="add-fact-box">
                                        <div class="select-box">
                                            <select id="activityOutcomes" name="activityOutcomes">
                                                <option th:value="${noOutcome}">Outcome of Activity</option>
                                                <option th:each="outcome : ${activityOutcomes}"
                                                        th:value="${outcome}"
                                                        th:text="${outcome}"
                                                        th:selected="${outcome == selectedOutcome}"></option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="submit-button" style="padding-top: 5%;">
                                        <button id="createEvent" type="submit" class="registerLoginButton">Add Outcome</button>
                                    </div>

                                </form>
                            </div>

                        </div>

                    </div>
                        <div style="width: 100%; display: inline-block">
                        <div class="submit-button" style="width: 25%; min-width: 150px; float: left; padding-top: 25px; padding-bottom: 8px">
                            <a th:if="${activity.team==null || (activity.team.isManager(currentUser.get()) || activity.team.isCoach(currentUser.get()))}"
                               th:href="@{createActivity(edit=${activity.id})}" type="button">
                                <button type="submit" id="editActivityBtn">Edit</button>
                            </a>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content-box" id="facts-tab" style="margin-bottom: 16px">
            <div class="content">
                <div th:if="${activity.team==null || (activity.team !=null && (activity.team.isManager(currentUser.get()) ||
                activity.team.isCoach(currentUser.get())))}" class="submit-button"
                     style="padding-top: 10px; padding-bottom: 10px">
                    <button style="width: 50%" onclick="addFactModal.style.display = 'block'">Add Fact</button>
                </div>

                <div id="addFactModal" class="modal"
                     th:style="${factInvalid != null ? 'display:block' : 'display:none'}">

                    <div class="add-goal-modal-content event" style="bottom: unset">
                        <span class="close" onclick="addFactModal.style.display = 'none'">&times;</span>
                        <form style="height: unset" th:action="@{add-fact}" id="addFactForm" method="post"
                              th:object="${addFactForm}" class="view-activity-form">
                            <input type="hidden" th:name="actId" th:value="${activity.getId()}"/>
                            <h3 class="add-fact-title">Add Fact</h3>
                            <div class="add-fact-box">
                                <div>
                                    <div style="margin-bottom: -10px" class="factTime-input-div">
                                        <div>
                                            <label class="fact-input" for="time-of-fact">Time (minutes)</label>
                                        </div>
                                        <div style="display: unset" th:each="err : ${#fields.errors('timeOfFact')}"
                                             th:text="${err}" class="error-message"></div>
                                        <div style="margin-bottom: 10%; padding-top: 5px" class="number-spinner">
                                            <button class="decrement" data-target="time-of-fact">-</button>
                                            <input type="number" class="valueInputTime" min="0" value="0"
                                                   id="time-of-fact" name="timeOfFact">
                                            <button class="increment" data-target="time-of-fact">+</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="fact-desc">
                                    <label class="fact-input" for="description">Description*:</label>
                                    <textarea class="fact-input" name="description" id="description" type="text-area"
                                              rows="5" th:field="*{description}" th:value="${description}"></textarea>
                                    <p id="charCount" class="charCount"></p>
                                </div>
                                <div style="display: unset" th:each="err : ${#fields.errors('description')}"
                                     th:text="${err}" class="error-message"></div>
                            </div>
                            <div class="submit-button" style="padding-top: 5%;">
                                <button id="createEvent" type="submit" class="registerLoginButton">Add Fact</button>
                            </div>

                        </form>
                    </div>

                </div>

                <table style="padding: 15px; border-collapse: collapse; border: 2px solid; border-radius: 5px; margin:2%; width:96%">
                    <thead style="background-color: #0b2239">
                    <tr>
                        <th style="width: 30%; background-color: #0b2239"> Time (minutes)</th>
                        <th style="width: 70%; background-color: #0b2239"> Description</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${factList.isEmpty()}">
                        <td colspan="2"> No Recorded Facts</td>
                    </tr>
                    <tr th:each="fact : ${factList}">
                        <td><span th:text="${fact.timeOfEvent} ?: 'No Time Recorded'">No Time Listed</span></td>
                        <td><span th:text="${fact.description}">Description</span></td>
                    </tr>
                    </tbody>
                </table>

            </div>
        </div>

        <div class="content-box" id="formation-tab">
            <div class="content" style="overflow: unset">
                 <div id="addSubModal" class="modal"
                         th:style="${subInvalid != null ? 'display:block' : 'display:none'}">
                     <div class="add-goal-modal-content event" style="bottom: unset">
                        <span class="close" onclick="addSubModal.style.display = 'none'">&times;</span>
                        <h3>Add Sub</h3>
                        <form style="height: unset" th:action="@{add-sub}" id="createEventForm" method="post" th:object="${createEventForm}" class="view-activity-form">
                            <input type="hidden" th:name="actId" th:value="${activity.getId()}"/>
                             <div class="select-container">
                                 <label class="goal-form-labels" for="playerOff" style="display: block">Player Off <span class="required">*</span> </label>
                                 <div class="select-box">
                                     <select id="playerOff" name="playerOff" required>
                                         <option th:each="player : ${playersInLineUp}"
                                                 th:value="${player.userId}"
                                                 th:text="${player.firstName + ' ' + player.lastName}"></option>
                                     </select>
                                    <ul>
                                        <li style="display: unset" th:each="err : ${#fields.errors('subOff')}"
                                            th:text="${err}" class="error-message"/>
                                    </ul>
                                </div>
                                 <label class="goal-form-labels" for="playerOn" style="display: block">Player On <span class="required">*</span> </label>
                                 <div class="select-box">
                                     <select id="playerOn" name="playerOn" required>
                                         <option th:each="player : ${playersNotInLineUp}"
                                                 th:value="${player.userId}"
                                                 th:text="${player.firstName + ' ' + player.lastName}"></option>
                                     </select>
                                    <ul>
                                        <li style="display: unset" th:each="err : ${#fields.errors('subOn')}"
                                            th:text="${err}" class="error-message"/>
                                    </ul>
                                </div>
                                <div class="description-box">
                                    <label class="goal-form-labels" for="description">Description</label>
                                    <textarea class="description-text" id="description" th:name="description" autofocus
                                              placeholder=""
                                              th:field="*{description}"></textarea>
                                    <ul>
                                        <li style="display: unset" th:each="err : ${#fields.errors('description')}"
                                            th:text="${err}" class="error-message"/>
                                    </ul>
                                </div>

                                 <div style="margin-bottom: -10px" class="goalTime-input-div">
                                     <label class="goal-form-labels" for="time-of-goal">Time (minutes)<span class="required">*</span></label>

                                     <div style="margin-bottom: 10%" class="number-spinner">
                                         <button class="decrement" data-target="time-of-sub">-</button>
                                         <input type="number" class="valueInputTime" value="0" min="0"
                                            id="time-of-sub" name="time">
                                         <button class="increment" data-target="time-of-sub">+</button>
                                     </div>
                                </div>

                                <ul>
                                    <li style="display: unset" th:each="err : ${#fields.errors('time')}"
                                        th:text="${err}" class="error-message"/>
                                </ul>
                                 <div style="padding-bottom: 11px; padding-top: 11px;" class="submit-button">
                                     <button style="width: 30%" id="addSub" type="submit"> Add </button>
                                 </div>
                             </div>
                        </form>
                     </div>
                 </div>
                <div class="formation-outer"
                     th:insert="~{fragments/formationDisplay.html::formationDisplay(false)}"
                     th:if="${formation != null}"
                     th:data-formation="${formation.formation}"
                     th:data-custom="${formation.custom}"
                     th:data-customPlayers="${formation.customPlayerPositions}"></div>
                <h3 style="margin: auto" th:if="${formation == null}">No formation information available</h3>

                <div>
                    <div class="sub-table">
                        <div class="sub-header">
                            <h4 class="sub-title">Substitutions</h4>
                        </div>
                        <div class="sub-list">
                            <ul>
                                <li class="sub-container" th:each="subsitution : ${activitySubstitutions}">
                                    <div class="sub-card">
                                        <div class="player-container">
                                            <img class="player-image"
                                                 th:src="@{/user-profile-picture/{id}(id = ${subsitution.playerOn.userId})}">
                                            <div class="player-in-container">
                                                <span>IN</span>
                                                <span class="player-in"
                                                      th:text="${subsitution.playerOn.firstName + ' ' + subsitution.playerOn.lastName}"></span>
                                            </div>
                                        </div>
                                        <img class="swap-icon" th:src="@{/image/icons/swap.svg}"/>
                                        <div class="player-container">
                                            <img class="player-image"
                                                 th:src="@{/user-profile-picture/{id}(id = ${subsitution.playerOn.userId})}">
                                            <div class="player-out-container">
                                                <span>OUT</span>
                                                <span class="player-out"
                                                      th:text="${subsitution.playerOff.firstName + ' ' + subsitution.playerOff.lastName}"></span>
                                            </div>
                                        </div>
                                        <div th:if="${subsitution.description != null}" class="dropdown-container">
                                            <img class="dropdown-icon" th:src="@{/image/icons/dropdown.svg}"
                                                 onclick="toggleDropdown(this)"/>
                                        </div>
                                        <div class="time-container">
                                            <h4 th:text="${subsitution.timeOfEvent} + '\''"></h4>
                                        </div>
                                    </div>
                                    <div class="sub-desc">
                                        <hr>
                                        <p th:text="${subsitution.description}"></p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="submit-button" style="padding-top: 5px">
                        <button onclick="addSubModal.style.display = 'block'" type="button"
                         th:style="${(playersInLineUp.size() > 0) ? null : 'display:none'}">Add Substitution</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="content-box" id="scores-tab">
            <div class="content">


                <div class="scoreboard">

                    <div class="score-display">

                        <div>
                            <h3 style="font-size: 30px" th:text="${activity.team}"></h3>


                        </div>


                        <hr class="scoreboard-divider">
                        <div class="scores-div">
                            <h1 th:if="${activity.activityTeamScore != null && activity.otherTeamScore != null}"
                                class="teamScore" th:text="${activity.activityTeamScore}"></h1>
                            <h1 th:if="${activity.activityTeamScore != null && activity.otherTeamScore != null}"
                                class="otherTeamScore" th:text="${activity.otherTeamScore}"></h1>
                        </div>
                        <div>
                            <h3 style="font-size: 30px">Opponent</h3>
                        </div>
                    </div>

                    <h3 class="winner-text" id="winnerText" th:text="${outcomeString}"></h3>

                    <div class="score-form-button-div">

                        <div class="overallScoreButtonDiv">
                            <div th:if="${activity.team != null && (activity.team.isManager(currentUser.get()) || activity.team.isCoach(currentUser.get()))}"
                                 class="submit-button">
                                <button th:unless="${noFacts}" onclick="overallScoreModal.style.display = 'block'"
                                        type="button">Add Overall Score
                                </button>
                            </div>
                        </div>

                        <div class="goalScoreButtonDiv">
                            <div th:if="${activity.team != null && (activity.team.isManager(currentUser.get()) || activity.team.isCoach(currentUser.get()))}"
                                 class="submit-button">
                                <button th:unless="${noFacts}" onclick="addGoalModal.style.display = 'block'"
                                        type="button">Add Goal
                                </button>
                            </div>
                        </div>

                    </div>

                    <div id="addOverallScoreModal" class="modal"
                         th:style="${scoreInvalid != null ? 'display:block' : 'display:none'}">

                        <div class="overall-score-modal-content event" style="bottom: unset">
                            <span class="close" onclick="overallScoreModal.style.display = 'none'">&times;</span>
                            <form style="height: unset" th:action="@{overall-score}" id="createEventForm" method="post"
                                  th:object="${createEventForm}" class="view-activity-form">
                                <input type="hidden" th:name="actId" th:value="${activity.getId()}"/>
                                <h3 style="text-align: center">Add Overall Score</h3>

                                <div class="overall-scores-box">

                                    <div class="opponentScoreDiv" style="float: left;">
                                        <label class="teamScoreLabel" style="display:block; color: #919191;"
                                               for="overall-score-team">Team</label>
                                        <input class="overall-score-input" name="overallScoreTeam"
                                               id="overall-score-team" type="text-area" th:field="*{overallScoreTeam}"
                                               th:value="${overallScoreTeamSaved}" data-cy="overallScoreTeam">

                                    </div>

                                    <div class="opponentScoreDiv" style="float:right">
                                        <label style="color: #919191; display:block; margin-left: 36%"
                                               for="overall-score-opponent">Opponent</label>
                                        <input style="float: right" class="overall-score-input"
                                               name="overallScoreOpponent" id="overall-score-opponent" type="text-area"
                                               th:field="*{overallScoreOpponent}"
                                               th:value="${overallScoreOpponentSaved}" data-cy="overallScoreOpponent">

                                    </div>
                                </div>
                                <div th:each="err : ${#fields.errors('overallScoreTeam')}" th:text="${err}"
                                     style="display: unset" class="error-message"></div>


                                <label style="padding-top: 10px;" class="helpText"> Scores for both teams should be of
                                    the same format i.e either 12-4 and 9-3 or 23 and 18 </label>


                                <div style="padding-bottom: 11px; padding-top: 11px;" class="submit-button">
                                    <button style="width: 30%" id="createEvent" type="submit"> Add</button>
                                </div>


                            </form>
                        </div>

                    </div>


                    <div id="addGoalModal" class="modal"
                         th:style="${goalInvalid != null ? 'display:block' : 'display:none'}">

                        <div class="add-goal-modal-content event" style="bottom: unset">
                            <span class="close" onclick="addGoalModal.style.display = 'none'">&times;</span>
                            <form style="height: unset" th:action="@{add-goal}" id="goalForm" method="post"
                                  th:object="${createEventForm}" class="view-activity-form">
                                <input type="hidden" th:name="actId" th:value="${activity.getId()}"/>
                                <h3>Add Goal</h3>
                                <div class="select-container">
                                    <label class="goal-form-labels" for="scorer" style="display: block">Scorer <span
                                            class="required">*</span> </label>
                                    <div class="select-box">
                                        <select id="scorer" name="scorer">
                                            <option th:each="player : ${playersInTeam}"
                                                    th:value="${player.userId}"
                                                    th:text="${player.firstName + ' ' + player.lastName}"></option>
                                        </select>

                                        <ul>
                                            <li style="display: unset" th:each="err : ${#fields.errors('scorer')}"
                                                th:text="${err}" class="error-message"/>
                                        </ul>
                                    </div>
                                </div>

                                <div class="description-box">
                                    <label class="goal-form-labels" for="description-goal">Description</label>
                                    <textarea class="description-text" id="description-goal" th:name="description" autofocus
                                              placeholder=""
                                              th:field="*{description}"></textarea>
                                    <p id="charCountGoal" class="charCountGoal"></p>
                                </div>
                                <div style="display: unset" th:each="err : ${#fields.errors('description')}" th:text="${err}"
                                     class="error-message"></div>

                                <div class="time-goal-value-div">

                                    <div style="margin-bottom: -10px" class="goalTime-input-div">
                                        <label class="goal-form-labels" for="time-of-goal">Time (minutes)<span
                                                class="required">*</span></label>

                                        <div style="margin-bottom: 10%" class="number-spinner">
                                            <button class="decrement" data-target="time-of-goal" type="button">-</button>
                                            <input type="number" class="valueInputTime" value="0" min="0"
                                                   id="time-of-goal" name="time">
                                            <button class="increment" data-target="time-of-goal" type="button">+</button>
                                        </div>
                                    </div>


                                    <div class="goal-input-div">
                                        <label class="goal-form-labels" for="goal-value">Goal Value</label>
                                        <div class="number-spinner">
                                            <button class="decrement" data-target="goal-value">-</button>
                                            <input type="number" class="valueInputGoal" value="1" min="1"
                                                   id="goal-value" name="goalValue">
                                            <button class="increment" data-target="goal-value">+</button>
                                        </div>

                                    </div>

                                </div>

                                <div style="display: unset" th:each="err : ${#fields.errors('time')}" th:text="${err}"
                                     class="error-message"></div>


                                <div style="padding-bottom: 11px; padding-top: 11px;" class="submit-button">
                                    <button style="width: 30%" id="createGoal" type="submit"> Add</button>
                                </div>


                            </form>
                        </div>

                    </div>


                </div>


                <div class="goal-table" style="margin-left: 4%">
                    <div class="goal-header">
                        <h4 class="goal-title">Scoring</h4>
                    </div>
                    <div class="goals-list">
                        <ul>
                            <li th:each="goal : ${activityGoals}">
                                <button class="collapsible">
                                    <img th:src="@{/user-profile-picture/{id}(id = ${goal.scorer.userId})}"
                                         class="scorer-player-image" alt="Player Image">
                                    <h3 th:text="${goal.scorer.firstName + ' ' + goal.scorer.lastName}"></h3>
                                    <h4 class="goal-text"
                                        th:text="${goal.goalValue == 1 ? goal.goalValue + ' pt' : goal.goalValue + ' pts'}"></h4>

                                    <div class="timeDiv">
                                        <h4 style="margin-top: 1px;" th:text="${goal.timeOfEvent} + '\''"></h4>
                                    </div>

                                </button>

                                <div class="goal-description">
                                    <hr class="solid">
                                    <p th:text="${goal.description}"></p>
                                </div>
                            </li>
                        </ul>
                    </div>

                </div>


            </div>
        </div>

    </div>

</div>


<script th:inline="javascript">

    function render() {
        setTimeout(function () {
            loadFormation();
        }, 500);
    }

    function loadFormation() {
        const formationOuter = document.querySelector(".formation-outer");
        const formation = formationOuter.getAttribute("data-formation");
        const custom = formationOuter.getAttribute("data-custom");
        const customPlayers = formationOuter.getAttribute("data-customPlayers");
        generatedOrCustom(formation, JSON.parse(custom), customPlayers);
        addPlayers();
    }

    function addPlayers() {
        const playersAndPositions = /*[[${playersAndPositions}]]*/ {};
        const playerNames = /*[[${playerNames}]]*/ {};
        const positions = pitch.childNodes;
        console.log(playersAndPositions);
        console.log(playerNames);
        console.log(positions);

        for (const positionIndex in playersAndPositions) {
            const playerId = playersAndPositions[positionIndex];
            const playerName = playerNames[positionIndex];

            const position = positions[positionIndex - 1];

            if (position) {
                const playerNameElement = position.querySelector('h3');
                playerNameElement.textContent = playerName;
                playerNameElement.style.display = 'inline-block';
                playerNameElement.style.width = 'auto';
                playerNameElement.style.marginLeft = '-4px';

                const playerImage = position.querySelector('.player-profile-img');
                playerImage.src = "user-profile-picture/" + playerId;
                playerImage.alt = "My Profile";

                position.style.backgroundImage = 'none';
            }
        }

    }

    function setUpIncrementSteppers(increaseButton) {
        const valueInput = document.getElementById(increaseButton.dataset.target);
        increaseButton.addEventListener('click', (event) => {
            event.preventDefault();
            valueInput.value = parseInt(valueInput.value, 10) + 1;
        });
    }

    function setUpDecrementStepper(decreaseButton) {
        const valueInput = document.getElementById(decreaseButton.dataset.target);
        const min = valueInput.getAttribute('min');
        decreaseButton.addEventListener('click', (event) => {
            event.preventDefault();
            const currentValue = parseInt(valueInput.value, 10);
            if (min !== null && currentValue > min) {
                valueInput.value = currentValue - 1;
            }
        });
    }

    for (const elem of document.getElementsByClassName("decrement")) {
        setUpDecrementStepper(elem);
    }

    for (const elem of document.getElementsByClassName("increment")) {
        setUpIncrementSteppers(elem);
    }

    var addGoalModal = document.getElementById("addGoalModal");
    var overallScoreModal = document.getElementById("addOverallScoreModal");
    var addSubModal = document.getElementById("addSubModal");
    var addFactModal = document.getElementById("addFactModal");
    var outcomeModal = document.getElementById("outcomeModal");

    window.onclick = function(event) {
        if (event.target === overallScoreModal) {
            overallScoreModal.style.display = "none";
        }
        if (event.target === addGoalModal) {
            addGoalModal.style.display = "none";
        }
        if (event.target === addSubModal) {
            addSubModal.style.display = "none";
        }
        if (event.target === outcomeModal) {
            outcomeModal.style.display = "none";
        }
    }

    function toggleDropdown(icon) {
        const subCard = icon.closest('.sub-card');
        const subDesc = subCard.nextElementSibling;
        const subLi = subCard.parentElement;
        console.log(subLi.className);
        console.log(subDesc.style.display)
        if (subDesc.style.display === 'none' || subDesc.style.display === '') {
            icon.style.transform = 'rotate(180deg)';
            subDesc.style.display = 'block';
            subLi.style.border = '2px solid rgb(119, 141, 169)';
            subLi.style.borderRadius = '10px';
            subLi.style.height = 'fit-content';
            subCard.style.border = 'none';
        } else {
            icon.style.transform = 'rotate(0deg)';
            subDesc.style.display = 'none';
            subLi.style.border = 'none';
            subCard.style.border = '2px solid rgb(119, 141, 169)';
            subLi.style.height = 'none';
        }
    }

    var collapsible = document.getElementsByClassName("collapsible");
    var i;


    for (i = 0; i < collapsible.length; i++) {
        collapsible[i].addEventListener("click", function () {
            this.classList.toggle("active");
            var content = this.nextElementSibling;
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
                content.style.border = "none";
                this.style.borderRadius = "10px 10px 10px 10px";
                this.style.borderBottom = "2px solid #778da9"


            } else {
                content.style.maxHeight = content.scrollHeight + 5 + "px";
                content.style.border = "2px #778da9"
                content.style.borderStyle = "none solid solid solid"
                this.style.borderRadius = "10px 10px 0 0";
                this.style.borderBottom = "none";
            }
        });
    }


    //tab functionality
    const tabs = document.querySelectorAll('.tab');
    const tabLine = document.querySelector('.tab-line');
    const displayBox = document.querySelectorAll('.content-box');
    const displayContent = document.querySelectorAll('.content');


    //functionality staying on tab after form submission
    var stayOnTab_Name = document.getElementById("stayOnTab_Name").innerHTML;
    var stayOnTab_Index = document.getElementById("stayOnTab_index").innerHTML;

    console.log("tabname" + stayOnTab_Name);
    console.log("tabindex" + stayOnTab_Index);

    if (stayOnTab_Name === "score-tab" || stayOnTab_Name === "generalTab" || stayOnTab_Name === "formations-tab" || stayOnTab_Name === "facts-tab") {
        var tabToBeActive = document.getElementById(stayOnTab_Name)

        console.log(tabToBeActive)
        console.log(stayOnTab_Name)
        tabs.forEach(otherTab => {
            otherTab.classList.remove('active');
        });
        tabToBeActive.classList.add('active')

        displayBox.forEach(box => {
            box.classList.remove('active')
        });
        displayBox[stayOnTab_Index].classList.add('active');
        displayContent.forEach(content => {
            content.classList.remove('active')
        });
        displayContent[stayOnTab_Index].classList.add('active');

    }

    //functionality for clicking on tabs
    tabs.forEach((tab, index) => {
        tab.addEventListener('click', (e) => {
            tabs.forEach(otherTab => {
                otherTab.classList.remove('active');
            });
            tab.classList.add('active');
            if (index === 0) {
                tabLine.style.left = "18px";
            } else if (index === 1) {
                tabLine.style.left = "247px";
            } else if (index === 2) {
                tabLine.style.left = "460px";
            } else {
                tabLine.style.left = "685px";
            }
            displayBox.forEach(box => {
                box.classList.remove('active')
            });
            displayBox[index].classList.add('active');
            displayContent.forEach(content => {
                content.classList.remove('active')
            });
            displayContent[index].classList.add('active');
        });
    });

    //Description Char Limit For Fact
    const textareaFact = document.getElementById('description');
    const charCountFact = document.getElementById('charCount');
    const textareaGoal = document.getElementById('description-goal');
    const charCountGoal = document.getElementById('charCountGoal');
    const limit = 150;

    textareaFact.addEventListener('input', function() {
        const value = textareaFact.value;
        const remainingChars = limit - value.length;
        charCountFact.textContent = `Characters remaining: ${remainingChars}`;

        if (remainingChars <= 0) {
            textareaFact.style.borderColor = 'red';
            charCountFact.style.color='red';
        } else {
            textareaFact.style.borderColor = '#415a77';
            charCountFact.style.color='#888888';
        }
    });

    textareaGoal.addEventListener('input', function() {
        const value = textareaGoal.value;
        const remainingChars = limit - value.length;
        charCountGoal.textContent = `Characters remaining: ${remainingChars}`;

        if (remainingChars <= 0) {
            textareaGoal.style.borderColor = 'red';
            charCountGoal.style.color='red';
        } else {
            textareaGoal.style.borderColor = '#415a77';
            charCountGoal.style.color='#888888';
        }
    });
</script>
</div>
</body>
<footer>
    <p>
        Image by <a
            href="https://www.freepik.com/free-vector/flat-happy-children-play-run-cycling-public-park_27059506.htm#query=nature%20sports%20illustration&position=0&from_view=search&track=ais">redgreystock</a>
        on Freepik
    </p>
</footer>

</html>
