
<!-- /*
listItems: List<String> - The list of items shown in the dropdown
optionName: String - What the dropdown is called "e.g. 'Filter by city'"
dropdownName: String[opt.] - The parameter name sent to the controller on submit
*/ -->
<div th:fragment="filterDropdownFragment(listItems, optionName, dropdownName)">

<div class="multipleSelection">
  <div class="selectBox"
       onclick="showCheckboxes()">
    <select>
      <option th:text="${optionName}"></option>
    </select>
    <div class="overSelect"></div>
  </div>
  <div id="checkBoxes">
    <label for="select_all">
      <input type="checkbox" id="select_all" onclick=selectAllCheckboxes(this) />
      Select all
    </label>
  </div>
</div>
  <script th:inline="javascript">
    var show = true;
    var checkBoxname = /*[[${dropdownName}]]*/ "dropdownItem";
    var listCities = /*[[${listItems}]]*/ [];

    function showCheckboxes() {
      var checkboxes = document.getElementById("checkBoxes");

      if (show) {
        checkboxes.style.display = "block";
        show = false;
      } else {
        checkboxes.style.display = "none";
        show = true;
      }
    }

    function init() {
      // Build the checkbox
      const currentURL = new URL(document.location.href);
      const preCheckedBoxes = new Set(currentURL.searchParams.getAll(checkBoxname));
      var checkboxDiv = document.getElementById("checkBoxes");
      var selectAllCheckbox = document.getElementById("select_all");
      for (const entryName of listCities) {
        var checkBox = document.createElement("input");
        var label = document.createElement("label");
        var span = document.createElement("span");
        checkBox.type = "checkbox";
        checkBox.value = entryName;
        checkBox.name = checkBoxname;
        checkBox.checked = preCheckedBoxes.has(entryName);
        checkBox.onclick = function() { updateSelectAllCheckbox(selectAllCheckbox); };
        span.appendChild(document.createTextNode(entryName));
        label.appendChild(checkBox)
        label.appendChild(span)
        checkboxDiv.appendChild(label);
      }
    }

    /* This function unchecks the `Select All` box if all checkboxes aren't checked, then
        re-checks it all of them are */
    function updateSelectAllCheckbox(selectAllCheckbox) {
      const checkboxes = Array.from(document.getElementsByName(checkBoxname));
      const allBoxesTicked = checkboxes.every(box => box.checked);
      if (selectAllCheckbox.checked && !allBoxesTicked) {
        selectAllCheckbox.checked = false;
      } else if (!selectAllCheckbox.checked && allBoxesTicked) {
        selectAllCheckbox.checked = true;
      }
    }

    function selectAllCheckboxes(selectAllCheckbox) {
      var checkboxes = document.getElementsByName(checkBoxname);
      if (selectAllCheckbox.checked) {
        for (var i=0; i < checkboxes.length; i++) {
          if(checkboxes[i].type == 'checkbox')
            checkboxes[i].checked = true;
        }} else {
        for (var i=0; i < checkboxes.length; i++) {
          if(checkboxes[i].type == 'checkbox')
            checkboxes[i].checked = false;
        }}
    }

    init();

  </script>
</div>

