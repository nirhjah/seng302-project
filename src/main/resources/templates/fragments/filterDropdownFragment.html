<!-- /*
listItems: List<String> - The list of items shown in the dropdown
optionName: String - What the dropdown is called "e.g. 'Filter by city'"
dropdownName: String[opt.] - The parameter name sent to the controller on submit
*/ -->
<div th:fragment="filterDropdownFragment(listItems, optionName, dropdownName)"
     th:with="dropdown_id=|checkbox-${dropdownName}|">
  <!--/* We set custom ID names so we can use this fragment multiple times on the same page */-->
  <div class="multipleSelection">
    <div class="selectBox" th:data-dropdown="${dropdown_id}" onclick="showCheckboxes(this.dataset.dropdown)">
      <!--/* The name shown at the top of the dropdown */-->
      <select>
        <option th:text="${optionName}">I'm a cool dropdown</option>
      </select>
      <div class="overSelect"></div>
    </div>
    <ul class="multi-select-selected">
      <li>Hello
      </li>
      <li>Goodbye
      </li>
      <li>Left
      </li>
      <li>Right
      </li>
    </ul>
    <div th:id="${dropdown_id}" class="checkbox" style="display: none">
      <th:block th:each="entry: ${listItems}">
        <label>
          <input type="checkbox" th:name="${dropdownName}" th:value="${entry}" th:text="| ${entry}|">
        </label>
      </th:block>
    </div>
  </div>
  <script th:inline="javascript">
    var everyItem;
    if (everyItem === undefined) {
      everyItem = new Map();
    }
    everyItem.set(/*[[${dropdownName}]]*/ "", /*[[${listItems}]]*/ []);

    /** Pre-check any boxes checked when the page was last submitted. */
    function init(checkboxName) {
      // Read the query arguments to see what boxes were checked when last submitted
      const currentURL = new URL(document.location.href);
      const preCheckedBoxes = new Set(currentURL.searchParams.getAll(checkboxName));
      // Then check them
      const checkboxes = document.getElementsByName(checkboxName);
      for (const check of checkboxes) {
        check.checked = preCheckedBoxes.has(check.value);
      }
    }

    function showCheckboxes(dropdownId) {
      var checkboxes = document.getElementById(dropdownId);

      if (checkboxes.style.display === "none") {
        checkboxes.style.display = "block";
      } else if (checkboxes.style.display === "block") {
        checkboxes.style.display = "none";
      } else {
        console.error("`checkboxes.style.display` was neither 'block' nor 'none', but a secret third thing:", checkboxes.style.display);
      }
    }

    init(/*[[${dropdownName}]]*/ "")
  </script>
</div>
