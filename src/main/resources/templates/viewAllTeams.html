<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" context="text/html; charset=UTF-8">
    <link th:href="@{/css/styles.css}" rel="stylesheet">
    <title>View All Teams</title>
</head>
<body class="view-teams-background">
<div>
    <div th:insert="~{homeForm.html::navbar(navTeams=${displayTeams})}"></div>

    <form id="search-form" th:action="@{view-teams}" method="get">
        <div class="search-bar">
            <input class ="team-name-input" type="text" id="searchQuery" name="searchQuery" th:value="${searchQuery}" placeholder="Search Teams" />
            <div class="search-team-button-div">
                <button class ="search-team-button" type="submit"><img width="40px" th:src="@{image/search.png}"></button>
            </div>
        </div>
        <div th:if="${not #lists.isEmpty(teams)}" style="display: flex">
            <div th:replace="~{/fragments/filterDropdownFragment.html::filterDropdownFragment(${cities}, 'Filter by city', 'cities')}" th:if="${not #lists.isEmpty(teams)}"></div>
            <div th:replace="~{/fragments/filterDropdownFragment.html::filterDropdownFragment(${sports}, 'Filter by sport', 'sports')}" th:if="${not #lists.isEmpty(teams)}"></div>
            <button class="filter-by-city-button" type="submit">Apply Filters</button>
        </div>
    </form>

    <script>
        // get search form and input element
        const form = document.getElementById('search-form');
        const input = document.getElementById('searchQuery');

        form.addEventListener('submit', (event) => {
            // if the value is less than 3 characters, prevent form from submitting
            if (input.value.length > 0 && input.value.length < 3) {
                event.preventDefault();

                // Remove existing error message
                const existingErrorMessage = document.getElementById('search-error');
                if (existingErrorMessage) {
                    existingErrorMessage.remove();
                }
                // Display error message
                const errorMessage = document.createElement('p');
                errorMessage.setAttribute('id', 'search-error');
                errorMessage.textContent = "search must be at least 3 characters";
                form.appendChild(errorMessage);
            }
        });
    </script>

    <table id="teamTable">
        <thread>
            <tr>
                <th>Profile Picture</th>
                <th>Name</th>
                <th>Sport</th>
                <th>Location</th>
            </tr>
        </thread>
        <tbody>
        <tr th:each="team : ${teams}"
            th:onclick="|window.location.href='/profile?teamID=${team.teamId}'|">
            <td>
                <img th:src="${'data:image/jpeg;base64,' + team.pictureString}" width="50" height="50"/>
            </td>
            <td th:text="${team.name}"></td>
            <td th:text="${team.sport}"></td>
            <td th:text="${team.location}"></td>
        </tr>
        </tbody>
    </table>

    <div th:insert="~{fragments/pagination.html :: pagination(pageName = 'view-teams', page = ${page}, totalPages = ${totalPages})}"></div>
</div>
<footer>
    <p>
        Image by <a href="https://www.freepik.com/free-vector/flat-happy-children-play-run-cycling-public-park_27059506.htm#query=nature%20sports%20illustration&position=0&from_view=search&track=ais">redgreystock</a> on Freepik
    </p>
</footer>
</body>
</html>
