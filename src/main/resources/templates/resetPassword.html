<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://thymeleaf.org">

<head>
  <link th:href="@{/css/styles.css}" rel="stylesheet"/>
  <link th:href="@{/css/password.css}" rel="stylesheet"/>
  <meta http-equiv="Content-Type" context="text/html; charset=UTF-8">
  <link th:href="@{/css/login.css}" rel="stylesheet" />
  <link th:href="@{/css/view-all.css}" rel="stylesheet" />
  <title>Forgot Password</title>
</head>


<body class="team-form-background">
<!-- add navbar-->
<div th:insert="~{fragments/navBar.html::navbar(displayTeams=${displayTeams})}"></div>
<div class="forgotPassword-form">
  <div class="login-header">
  </div>
  <div class="wrapper">



    <form id="reset-password-form" th:action="@{reset-password}" method="post" th:object="${resetPasswordForm}">
      <h3 class="reset-password-info" style="text-align: center"> Reset Password </h3>

      <div class="input-box">
        <input type="password" class="form-control" id="password" placeholder="" th:field="*{password}"
               data-cy="password" autofocus required oninput="checkPasswordStrength(this)">
        <label for="password"> New Password <span class="required">*</span></label>
        <img th:src="@{/image/icons/hide.png}" class="password-toggle" data-pw-field="oldPassword" />
      </div>
      <div class="password-info">
        <div class="password-strength-meter">
          <div class="bar"></div>
        </div>
        <div class="password-strength-text"></div>
        <ul class="password-information-text">
          <li id="password-min-characters"><img th:src="@{/image/icons/password-cross.svg}" /> Password must be at least 8 characters</li>
          <li class="password-items"> Must contain the following items: </li>
          <ul>
            <li id ="password-letter-case"><img th:src="@{/image/icons/password-cross.svg}" /> Uppercase and lowercase letters</li>
            <li id="password-numbers"><img th:src="@{/image/icons/password-cross.svg}" /> Numbers</li>
            <li id="password-symbols"><img th:src="@{/image/icons/password-cross.svg}" /> Symbols</li>
          </ul>
          <li id="password-user-details"><img th:src="@{/image/icons/password-cross.svg}" /> Mustn't contain your name or email</li>
        </ul>
      </div>

      <div class="input-box">
        <input type="password" class="form-control" id="confirm-password" placeholder=""
               th:field="*{confirmPassword}" data-cy="confirmPassword" autofocus>
        <label for="confirm-password"> Retype Password <span class="required">*</span></label>
        <ul>
          <li th:each="err : ${#fields.errors('password')}" th:text="${err}" class="password-error-message" />
        </ul>

      </div>
      <br>

      <div class="password-info">
        <p class="reset-password-info">Password must be at least <strong>8 characters</strong>, contain <strong>upper</strong> and <strong>lower</strong> case letters, <strong>numbers</strong> and <strong>symbols</strong>, and can't contain your <strong>name</strong> or <strong>email</strong></p>
      </div>



      <br />
      <div class="submit-button">
        <button type="submit" formnovalidate>Reset Password</button>

      </div>



    </form>
  </div>
</div>
<script type="text/javascript" th:src="@{/js/passwordStrengthMeter.js}"> </script>
<footer>
  <p>
    Image by <a
          href="https://www.freepik.com/free-vector/flat-happy-children-play-run-cycling-public-park_27059506.htm#query=nature%20sports%20illustration&position=0&from_view=search&track=ais">redgreystock</a>
    on Freepik
  </p>
</footer>
</body>
<script th:inline="javascript">
  const FIRST_NAME = /*[[ ${#strings.toLowerCase(user.firstName)} ]]*/ "";
  const LAST_NAME = /*[[ ${#strings.toLowerCase(user.lastName)} ]]*/ "";
  const EMAIL = /*[[ ${#strings.toLowerCase(user.email)} ]]*/ "";
  console.log(FIRST_NAME)
  console.log(LAST_NAME)
  console.log(EMAIL)
  let passwordError = {};
  const passwordToggle = document.getElementsByClassName('password-toggle');
  for (const button of passwordToggle) {
    const passwordFieldId = button.dataset.pwField;
    const passwordInput = document.getElementById(passwordFieldId);
    button.addEventListener('click', function () {
      if (passwordInput.type === 'text') {
        passwordInput.type = 'password';
        button.src = 'image/icons/hide.png';
      } else {
        passwordInput.type = 'text';
        button.src = 'image/icons/view.png';
      }
    });
  }
  function checkPasswordStrength(elem) {

    const bar = document.querySelector(".password-strength-meter .bar");
    var password = document.getElementById(elem.id).value;
    const minChar= document.getElementById("password-min-characters");
    const hasLetterCase= document.getElementById("password-letter-case");
    const hasNumber= document.getElementById("password-numbers");
    const hasSymbol= document.getElementById("password-symbols");
    const ownDetails= document.getElementById("password-user-details");
    password=password.trim()
    document.getElementById(elem.id).value = password;

    if (password) {
      const minCharImg = minChar.querySelector("img");
      const letterCaseImg = hasLetterCase.querySelector("img");
      const numberImg=hasNumber.querySelector("img");
      const symbolImg= hasSymbol.querySelector("img");
      const detailsImg= ownDetails.querySelector("img");
      const lowerPW = password.toLowerCase();
      let strength = 0;
      if (password.length >= 8) {
        minChar.style.color="green"
        minCharImg.src = "/image/icons/password-tick.svg";
        passwordError.minChar = true;

        strength++;
      }
      else{
        minChar.style.color="red"
        minCharImg.src = "/image/icons/password-cross.svg";
        passwordError.minChar = false;
      }
      if (/[A-Z]/.test(password)) {
        strength++;
      }
      if (/[a-z]/.test(password)) {
        strength++;
      }

      if (/[A-Z]/.test(password) &&/[a-z]/.test(password) ){
        hasLetterCase.style.color="green";
        letterCaseImg.src = "/image/icons/password-tick.svg";
        passwordError.letterCase = true;
      }
      else{
        hasLetterCase.style.color="red";
        letterCaseImg.src = "/image/icons/password-cross.svg";
        passwordError.letterCase = false;
      }
      if (/\d/.test(password)) {
        hasNumber.style.color="green";
        numberImg.src= "/image/icons/password-tick.svg";
        passwordError.hasNumber = true;
        strength++;
      }
      else{
        hasNumber.style.color="red";
        numberImg.src= "/image/icons/password-cross.svg";
        passwordError.hasNumber = false;
      }
      if (/[\W_]/.test(password)) {
        hasSymbol.style.color="green"
        symbolImg.src="/image/icons/password-tick.svg";
        passwordError.hasSymbol = true;
        strength++;
      }
      else{
        hasSymbol.style.color="red";
        symbolImg.src="/image/icons/password-cross.svg";
        passwordError.hasSymbol = false;
      }

      if (!lowerPW.includes(FIRST_NAME) && !lowerPW.includes(LAST_NAME) && !lowerPW.includes(EMAIL)) {
        ownDetails.style.color="green"
        detailsImg.src= "/image/icons/password-tick.svg";
        passwordError.ownDetails = true;
        strength++;
      }
      else{
        ownDetails.style.color="red"
        detailsImg.src="/image/icons/password-cross.svg";
        passwordError.ownDetails = false;
      }

      if (strength < 3) {
        bar.classList.remove("medium");
        bar.classList.remove("strong");
        bar.classList.add("weak");
        bar.style.width = "20%";
      } else if (strength < 6) {
        bar.classList.remove("strong");
        bar.classList.remove("weak");
        bar.classList.add("medium");
        bar.style.width = "50%";
      } else {
        bar.classList.remove("medium");
        bar.classList.remove("weak");
        bar.classList.add("strong");
        bar.style.width = "100%";
      }
    } else {
      bar.classList.remove("medium");
      bar.classList.remove("strong");
      bar.classList.remove("weak");
      bar.style.width = "0%";
    }
  }
</script>

</html>
